---
- block:
  - name: Ensure GitHub CLI keyring is installed
    get_url:
      url: https://cli.github.com/packages/githubcli-archive-keyring.gpg
      dest: /usr/share/keyrings/githubcli-archive-keyring.gpg
      mode: og+r
  - name: Get CPU architecture name
    command: dpkg --print-architecture
    register: arch
    when: true
    check_mode: false
  - name: Ensure GitHub CLI repo is registered
    apt_repository:
      repo: deb [arch={{ arch.stdout_lines[0] | regex_replace('^x86_64$', 'amd64')}} signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main
      filename: github-cli
  - name: Ensure GitHub CLI is installed
    package:
      name: gh
  when: ansible_os_family == "Debian"
  become: true
